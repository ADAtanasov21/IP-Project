{% extends "base.html" %}

{% block content %}
<div class="catalog-header">
    <h1>Каталог обувки</h1>

    <form class="filter-form" method="GET">
        <div class="filter-row">
            <input type="text" name="search" placeholder="Търсене..." value="{{ request.args.get('search', '') }}">
            <input type="text" name="color" placeholder="Цвят" value="{{ request.args.get('color', '') }}">
            <input type="number" name="min_price" placeholder="Мин. цена" step="0.01" value="{{ request.args.get('min_price', '') }}">
            <input type="number" name="max_price" placeholder="Макс. цена" step="0.01" value="{{ request.args.get('max_price', '') }}">
            <select name="size">
                <option value="">Всички размери</option>
                {% for size in ['37', '38', '39', '40', '41', '42', '43', '44'] %}
                    <option value="{{ size }}" {{ 'selected' if request.args.get('size') == size }}>{{ size }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-secondary">Филтрирай</button>
            <a href="{{ url_for('catalog.catalog') }}" class="btn btn-outline">Изчисти</a>
        </div>
    </form>
</div>

<div class="products-grid">
    {% for product in products %}
        <div class="product-card">
            <img src="{{ product.image }}" alt="{{ product.name }}" class="product-image">
            <div class="product-info">
                <h3>{{ product.name }}</h3>
                <p class="product-color">Цвят: {{ product.color }}</p>
                <p class="product-description">{{ product.description }}</p>
                <p class="product-price">{{ "%.2f"|format(product.price) }} лв.</p>
                <p class="product-sizes">Размери: {{ product.sizes|join(', ') }}</p>
                <p class="product-quantity">Налични: {{ product.quantity }} бр.</p>

                {% if product.quantity > 0 %}
                    <form class="add-to-cart-form" action="{{ url_for('cart.add_to_cart', product_id=product.id) }}" method="GET">
                        <select name="size" required>
                            <option value="">Изберете размер</option>
                            {% for size in product.sizes %}
                                <option value="{{ size }}">{{ size }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary">Добави в кошница</button>
                    </form>
                {% else %}
                    <p class="out-of-stock">Няма в наличност</p>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>

{% if not products %}
    <p class="no-products">Няма намерени продукти.</p>
{% endif %}
{% endblock %}
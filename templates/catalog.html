{% extends "base.html" %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ - Shoe Store{% endblock %}

{% block content %}
<div class="catalog-header">
    <h2>üëü –ö–∞—Ç–∞–ª–æ–≥ —Å –æ–±—É–≤–∫–∏</h2>
    
    <form method="GET" class="search-form">
        <div class="search-row">
            <input type="text" name="search" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –∏–º–µ –∏–ª–∏ —Ü–≤—è—Ç..." value="{{ request.args.get('search', '') }}">
            <select name="color">
                <option value="">–í—Å–∏—á–∫–∏ —Ü–≤–µ—Ç–æ–≤–µ</option>
                <option value="Black" {% if request.args.get('color') == 'Black' %}selected{% endif %}>–ß–µ—Ä–µ–Ω</option>
                <option value="White" {% if request.args.get('color') == 'White' %}selected{% endif %}>–ë—è–ª</option>
                <option value="Red" {% if request.args.get('color') == 'Red' %}selected{% endif %}>–ß–µ—Ä–≤–µ–Ω</option>
                <option value="Blue" {% if request.args.get('color') == 'Blue' %}selected{% endif %}>–°–∏–Ω</option>
                <option value="Green" {% if request.args.get('color') == 'Green' %}selected{% endif %}>–ó–µ–ª–µ–Ω</option>
                <option value="Brown" {% if request.args.get('color') == 'Brown' %}selected{% endif %}>–ö–∞—Ñ—è–≤</option>
            </select>
            <select name="size">
                <option value="">–í—Å–∏—á–∫–∏ —Ä–∞–∑–º–µ—Ä–∏</option>
                {% for size in ['36', '37', '38', '39', '40', '41', '42', '43', '44', '45'] %}
                <option value="{{ size }}" {% if request.args.get('size') == size %}selected{% endif %}>{{ size }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="search-row">
            <input type="number" name="min_price" placeholder="–ú–∏–Ω —Ü–µ–Ω–∞" step="0.01" value="{{ request.args.get('min_price', '') }}">
            <input type="number" name="max_price" placeholder="–ú–∞–∫—Å —Ü–µ–Ω–∞" step="0.01" value="{{ request.args.get('max_price', '') }}">
            <button type="submit" class="btn btn-secondary">üîç –¢—ä—Ä—Å–∏</button>
            <a href="{{ url_for('catalog.catalog') }}" class="btn btn-outline">‚ùå –ò–∑—á–∏—Å—Ç–∏</a>
        </div>
    </form>
</div>

<div class="products-grid">
    {% for product in products %}
    <div class="product-card">
        <div class="product-info">
            <h3>{{ product.name }}</h3>
            <p class="product-description">{{ product.description }}</p>
            <p class="product-color"><strong>–¶–≤—è—Ç:</strong> {{ product.color }}</p>
            <p class="product-sizes"><strong>–†–∞–∑–º–µ—Ä–∏:</strong> {{ product.sizes | join(', ') }}</p>
            <p class="product-price">üí∞ {{ "%.2f"|format(product.price) }} –ª–≤.</p>
            <p class="product-stock">üì¶ –í –Ω–∞–ª–∏—á–Ω–æ—Å—Ç: {{ product.stock }}</p>
        </div>
        
        {% if session.user_id %}
        <div class="add-to-cart-form">
            <select id="size-{{ product.id }}" required>
                <option value="">–ò–∑–±–µ—Ä–∏ —Ä–∞–∑–º–µ—Ä</option>
                {% for size in product.sizes %}
                <option value="{{ size }}">{{ size }}</option>
                {% endfor %}
            </select>
            <button onclick="addToCart({{ product.id }}, document.getElementById('size-{{ product.id }}').value)" class="btn btn-primary">üõí –î–æ–±–∞–≤–∏ –≤ –∫–æ—à–Ω–∏—Ü–∞</button>
        </div>
        {% else %}
        <p><a href="{{ url_for('auth.login') }}" class="btn btn-outline">–í–ª–µ–∑—Ç–µ –∑–∞ –¥–∞ –∫—É–ø—É–≤–∞—Ç–µ</a></p>
        {% endif %}
    </div>
    {% else %}
    <div class="no-products">
        <p>üòî –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏.</p>
        <a href="{{ url_for('catalog.catalog') }}" class="btn btn-primary">–ü–æ–∫–∞–∂–∏ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</a>
    </div>
    {% endfor %}
</div>

<script>
function addToCart(productId, size) {
    if (!size) {
        alert('–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ —Ä–∞–∑–º–µ—Ä');
        return;
    }
    window.location.href = "{{ url_for('cart.add_to_cart_route', product_id=0) }}".replace('0', productId) + '?size=' + size;
}
</script>
{% endblock %}